<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prueba de Generación de PDF</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Signature Pad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
  <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Prueba de Generación de PDF</h1>
    
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
        <input type="text" id="nombre" class="w-full px-3 py-2 border border-gray-300 rounded-md" value="Juan Pérez">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
        <input type="date" id="fecha" class="w-full px-3 py-2 border border-gray-300 rounded-md" value="2024-01-15">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
        <textarea id="observaciones" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md">Prueba de generación de PDF</textarea>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Firma</label>
        <div class="border-2 border-gray-300 rounded-md p-4">
          <canvas id="signature-pad" width="400" height="200"></canvas>
        </div>
        <button id="clear-signature" class="mt-2 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
          Limpiar Firma
        </button>
      </div>
      
      <button id="generate-pdf" class="w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors">
        Generar PDF
      </button>
    </div>
  </div>

  <script src="./js/pdf-generator.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded - Test');
      
      // Verificar que SignaturePad esté disponible
      if (typeof SignaturePad === 'undefined') {
        console.error('SignaturePad no está disponible');
      } else {
        console.log('SignaturePad está disponible');
      }
      
      // Verificar que jsPDF esté disponible
      if (typeof window.jspdf === 'undefined') {
        console.error('jsPDF no está disponible');
      } else {
        console.log('jsPDF está disponible');
      }
      
      // Inicializar SignaturePad
      const canvas = document.getElementById('signature-pad');
      let signaturePad = null;
      
      if (canvas) {
        console.log('Canvas encontrado, inicializando SignaturePad');
        signaturePad = new SignaturePad(canvas, {
          backgroundColor: 'rgb(255, 255, 255)',
          penColor: 'rgb(0, 0, 0)',
          velocityFilterWeight: 0.7,
          minWidth: 0.5,
          maxWidth: 2.5,
          throttle: 16
        });
        
        // Botón para limpiar la firma
        document.getElementById('clear-signature').addEventListener('click', function() {
          signaturePad.clear();
        });
      }
      
      // Inicializar el generador de PDF
      const pdfGenerator = new window.PDFGenerator();
      
      if (!pdfGenerator) {
        console.error('PDFGenerator no está disponible');
        return;
      } else {
        console.log('PDFGenerator inicializado correctamente');
      }
      
      // Función para generar PDF
      document.getElementById('generate-pdf').addEventListener('click', async function() {
        try {
          console.log('Generando PDF...');
          
          const formData = {
            fecha: document.getElementById('fecha').value,
            placa: 'ABC123',
            conductor: document.getElementById('nombre').value,
            kilometraje: '50000',
            items: {
              'Aseo general': 'Funcional',
              'Luces': 'Funcional',
              'Frenos': 'Funcional'
            },
            llantas: {
              'Llanta delantera': 'Funcional',
              'Llanta trasera': 'Funcional'
            },
            herramientas: {
              'Linterna': 'Funcional',
              'Chaleco': 'Funcional'
            },
            observaciones: document.getElementById('observaciones').value,
            signature: signaturePad && !signaturePad.isEmpty() ? signaturePad.toDataURL() : null
          };
          
          const pdfData = await pdfGenerator.generatePDF(formData);
          
          // Crear un enlace para descargar el PDF
          const link = document.createElement('a');
          link.href = pdfData;
          link.download = 'inspeccion-prueba.pdf';
          link.click();
          
          console.log('PDF generado exitosamente');
          
        } catch (error) {
          console.error('Error al generar PDF:', error);
          alert('Error al generar el PDF: ' + error.message);
        }
      });
    });
  </script>
</body>
</html> 